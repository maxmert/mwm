<!DOCTYPE html>  <html> <head>   <title>widgets.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="logger.html">                 logger.coffee               </a>                                           <a class="source" href="version.html">                 version.coffee               </a>                                           <a class="source" href="widgets.html">                 widgets.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               widgets.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">pack = </span><span class="nx">require</span> <span class="s">&#39;../package.json&#39;</span>
<span class="nv">templates = </span><span class="nx">require</span> <span class="s">&#39;../templates.json&#39;</span>
<span class="nv">request = </span><span class="nx">require</span> <span class="s">&#39;superagent&#39;</span>
<span class="nv">dialog = </span><span class="nx">require</span> <span class="s">&#39;commander&#39;</span>
<span class="nv">path = </span><span class="nx">require</span> <span class="s">&#39;path&#39;</span>
<span class="nv">log = </span><span class="nx">require</span> <span class="s">&#39;./logger&#39;</span>
<span class="nv">async = </span><span class="nx">require</span> <span class="s">&#39;async&#39;</span>
<span class="nv">tar = </span><span class="nx">require</span> <span class="s">&#39;tar&#39;</span>
<span class="nv">mustache = </span><span class="nx">require</span> <span class="s">&#39;mustache&#39;</span>

<span class="nv">fs = </span><span class="nx">require</span> <span class="s">&#39;fs&#39;</span>
<span class="nv">ncp = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;ncp&#39;</span><span class="p">).</span><span class="nx">ncp</span>
<span class="nv">fstream = </span><span class="nx">require</span> <span class="s">&#39;fstream&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Returns the —Åontent of maxmertkit.json file</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.maxmertkit = </span><span class="nf">-&gt;</span>
  
  <span class="nv">rawjson = </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="nx">pack</span><span class="p">.</span><span class="nx">maxmertkit</span> <span class="p">)</span>
  
  <span class="k">if</span> <span class="o">not</span> <span class="nx">rawjson</span><span class="o">?</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;couldn\&#39;t read </span><span class="si">#{</span><span class="nx">pack</span><span class="p">.</span><span class="nx">maxmertkit</span><span class="si">}</span><span class="s"> file.&quot;</span><span class="p">)</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>

  <span class="k">else</span>
    <span class="nv">json = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">rawjson</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p><strong>Initializing</strong>
a new widget/theme/modifier in the current directory</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.initApp = </span><span class="nf">( options ) -&gt;</span>

  <span class="k">if</span> <span class="o">not</span> <span class="nx">options</span><span class="p">.</span><span class="nx">theme</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">options</span><span class="p">.</span><span class="nx">modifier</span>

    <span class="nx">@initWidgetSubapp</span> <span class="nx">options</span>

  <span class="k">else</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">theme</span>

    <span class="nx">@initThemeSubapp</span> <span class="nx">options</span>

  <span class="k">else</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">modifier</span>

    <span class="nx">@initModifierSubapp</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><strong>Initializing</strong>
maxmertkit.json file with main info about project</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.initCommonSubapp = </span><span class="nf">( options, callback ) -&gt;</span>

  <span class="nx">async</span><span class="p">.</span><span class="nx">series</span>

    <span class="nv">type: </span><span class="nf">( callback ) -&gt;</span>

      <span class="k">if</span> <span class="o">not</span> <span class="nx">options</span><span class="p">.</span><span class="nx">theme</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">options</span><span class="p">.</span><span class="nx">modifier</span>

        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&#39;widget&#39;</span>

      <span class="k">else</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">theme</span>

        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&#39;theme&#39;</span>

      <span class="k">else</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">modifier</span>

        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="s">&#39;modifier&#39;</span>

    <span class="nv">name: </span><span class="nf">( callback ) -&gt;</span>
      <span class="nv">defaultPkgName = </span><span class="s">&#39;test&#39;</span>
      <span class="nx">dialog</span><span class="p">.</span><span class="nx">prompt</span> <span class="s">&quot;name: (test) &quot;</span><span class="p">,</span> <span class="nf">( pkgName ) -&gt;</span>
        <span class="k">if</span> <span class="nx">pkgName</span> <span class="o">is</span> <span class="s">&#39;&#39;</span> <span class="k">then</span> <span class="nv">pkgName = </span><span class="nx">defaultPkgName</span>
        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">pkgName</span>

    <span class="nv">version: </span><span class="nf">( callback ) -&gt;</span>
      <span class="nv">defaultVersion = </span><span class="s">&#39;0.0.0&#39;</span>
      <span class="nx">dialog</span><span class="p">.</span><span class="nx">prompt</span> <span class="s">&quot;version: (0.0.0) &quot;</span><span class="p">,</span> <span class="nf">( version ) -&gt;</span>
        <span class="k">if</span> <span class="nx">version</span> <span class="o">is</span> <span class="s">&#39;&#39;</span> <span class="k">then</span> <span class="nv">version = </span><span class="nx">defaultVersion</span>
        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">version</span>

    <span class="nv">description: </span><span class="nf">( callback ) -&gt;</span>
      <span class="nx">dialog</span><span class="p">.</span><span class="nx">prompt</span> <span class="s">&quot;description: &quot;</span><span class="p">,</span> <span class="nf">( description ) -&gt;</span>
        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">description</span>

    <span class="nv">repository: </span><span class="nf">( callback ) -&gt;</span>
      <span class="nx">dialog</span><span class="p">.</span><span class="nx">prompt</span> <span class="s">&quot;repository: &quot;</span><span class="p">,</span> <span class="nf">( repository ) -&gt;</span>
        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">repository</span>

    <span class="nv">author: </span><span class="nf">( callback ) -&gt;</span>
      <span class="nx">dialog</span><span class="p">.</span><span class="nx">prompt</span> <span class="s">&quot;author: &quot;</span><span class="p">,</span> <span class="nf">( author ) -&gt;</span>
        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">author</span>

    <span class="nv">license: </span><span class="nf">( callback ) -&gt;</span>
      <span class="nv">defaultLicense = </span><span class="s">&#39;BSD&#39;</span>
      <span class="nx">dialog</span><span class="p">.</span><span class="nx">prompt</span> <span class="s">&quot;license: (BSD) &quot;</span><span class="p">,</span> <span class="nf">( license ) -&gt;</span>
        <span class="k">if</span> <span class="nx">license</span> <span class="o">is</span> <span class="s">&#39;&#39;</span> <span class="k">then</span> <span class="nv">license = </span><span class="nx">defaultLicense</span>
        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">license</span>

  <span class="p">,</span> <span class="nf">( err, maxmertkitjson ) =&gt;</span>

    <span class="nx">@</span><span class="p">.</span><span class="nx">initWriteConfirm</span>  <span class="nx">pack</span><span class="p">.</span><span class="nx">maxmertkit</span><span class="p">,</span> <span class="nx">maxmertkitjson</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Function with json write confirmation.
Uses with maxmertkit.json, theme.json and modifier.json</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.initWriteConfirm = </span><span class="nf">( file, json, callback ) -&gt;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;\n\nWriting file </span><span class="si">#{</span><span class="nx">file</span><span class="si">}</span><span class="s">\n&quot;</span>
  <span class="nx">dialog</span><span class="p">.</span><span class="nx">confirm</span> <span class="s">&quot;Is everything correct? \n\n </span><span class="si">#{</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s">\n-&gt; &quot;</span><span class="p">,</span> <span class="nf">( ok ) =&gt;</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;&quot;</span>

      <span class="k">if</span> <span class="o">not</span> <span class="nx">ok</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;Initializing canceled&quot;</span><span class="p">)</span>
        <span class="nx">callback</span> <span class="nx">ok</span><span class="p">,</span> <span class="kc">null</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>

      <span class="k">else</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">exists</span> <span class="nx">file</span><span class="p">,</span> <span class="nf">( exists ) =&gt;</span>

          <span class="k">if</span> <span class="o">not</span> <span class="nx">exists</span>
            <span class="nx">@</span><span class="p">.</span><span class="nx">initWrite</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">json</span><span class="p">,</span> <span class="nx">callback</span>
            <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>

          <span class="k">else</span> <span class="c1">#if exists</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;File </span><span class="si">#{</span><span class="nx">file</span><span class="si">}</span><span class="s"> already exists.&quot;</span><span class="p">)</span>

            <span class="nx">dialog</span><span class="p">.</span><span class="nx">confirm</span> <span class="s">&quot;Do you want to overwrite it and all other files in that folder? -&gt; &quot;</span><span class="p">,</span> <span class="nf">( ok ) =&gt;</span>

              <span class="k">if</span> <span class="o">not</span> <span class="nx">ok</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;initialization canceled.&quot;</span><span class="p">)</span>
                <span class="nx">callback</span> <span class="nx">ok</span><span class="p">,</span> <span class="kc">null</span>
                <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>

              <span class="k">else</span>
                <span class="nx">@</span><span class="p">.</span><span class="nx">initWrite</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">json</span><span class="p">,</span> <span class="nx">callback</span>
                <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Function with json write.
Uses with maxmertkit.json, theme.json and modifier.json</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.initWrite = </span><span class="nf">( file, json, callback ) -&gt;</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nf">( err ) -&gt;</span>

    <span class="k">if</span> <span class="nx">err</span>
      <span class="nx">log</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;initializing ‚Äì </span><span class="si">#{</span><span class="nx">err</span><span class="si">}</span><span class="s">.&quot;</span>
      <span class="nx">callback</span> <span class="nx">err</span><span class="p">,</span> <span class="kc">null</span>

    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>TODO: Add some info about maxmertkit.json ??</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">log</span><span class="p">.</span><span class="nx">success</span> <span class="s">&quot;file </span><span class="si">#{</span><span class="nx">file</span><span class="si">}</span><span class="s"> successfully created.&quot;</span>
      <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">json</span>






<span class="nv">exports.initWidgetSubapp = </span><span class="nf">( options ) -&gt;</span>

  <span class="nx">async</span><span class="p">.</span><span class="nx">series</span>

    <span class="nv">common: </span><span class="nf">( callback ) =&gt;</span>

      <span class="nx">@initCommonSubapp</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span>


  <span class="p">,</span> <span class="nf">( err, res ) =&gt;</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;ok&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><strong>Initialization</strong>
of the theme</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.initThemeSubapp = </span><span class="nf">( options ) -&gt;</span>

  <span class="nv">fileName = </span><span class="s">&#39;theme.json&#39;</span>

  <span class="nx">async</span><span class="p">.</span><span class="nx">series</span>

    <span class="nv">common: </span><span class="nf">( callback ) =&gt;</span>

      <span class="nx">@initCommonSubapp</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span>


    <span class="nv">theme: </span><span class="nf">( callback ) =&gt;</span>

      <span class="nx">request</span>
        <span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">pack</span><span class="p">.</span><span class="nx">homepage</span><span class="si">}</span><span class="s">/defaults/theme&quot;</span> <span class="p">)</span>
        <span class="p">.</span><span class="nx">set</span><span class="p">(</span> <span class="s">&#39;X-Requested-With&#39;</span><span class="p">,</span> <span class="s">&#39;XMLHttpRequest&#39;</span> <span class="p">)</span>
        <span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;Accept&#39;</span><span class="p">,</span> <span class="s">&#39;application/json&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">end</span> <span class="nf">( res ) =&gt;</span>

          <span class="k">if</span> <span class="nx">res</span><span class="p">.</span><span class="nx">ok</span>
            <span class="nx">@initWrite</span> <span class="nx">fileName</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">callback</span>

          <span class="k">else</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">requestError</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">msg</span><span class="p">,</span> <span class="s">&#39;ERRR&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span>
            <span class="nx">callback</span> <span class="nx">res</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="kc">null</span>


  <span class="p">,</span> <span class="nf">( err, res ) =&gt;</span>

    <span class="k">if</span> <span class="nx">err</span><span class="o">?</span>
      <span class="nx">log</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;An error while initialized theme.&quot;</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>

    <span class="k">else</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p><strong>Initialization</strong>
of the modifier</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.initModifierSubapp = </span><span class="nf">( options ) -&gt;</span>

  <span class="nv">fileName = </span><span class="s">&#39;modifier.json&#39;</span>

  <span class="nx">async</span><span class="p">.</span><span class="nx">series</span>

    <span class="nv">common: </span><span class="nf">( callback ) =&gt;</span>

      <span class="nx">@initCommonSubapp</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span>


    <span class="nv">theme: </span><span class="nf">( callback ) =&gt;</span>

      <span class="nx">request</span>
        <span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">pack</span><span class="p">.</span><span class="nx">homepage</span><span class="si">}</span><span class="s">/defaults/modifier&quot;</span> <span class="p">)</span>
        <span class="p">.</span><span class="nx">set</span><span class="p">(</span> <span class="s">&#39;X-Requested-With&#39;</span><span class="p">,</span> <span class="s">&#39;XMLHttpRequest&#39;</span> <span class="p">)</span>
        <span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;Accept&#39;</span><span class="p">,</span> <span class="s">&#39;application/json&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">end</span> <span class="nf">( res ) =&gt;</span>

          <span class="k">if</span> <span class="nx">res</span><span class="p">.</span><span class="nx">ok</span>
            <span class="nx">@initWrite</span> <span class="nx">fileName</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">callback</span>

          <span class="k">else</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">requestError</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">msg</span><span class="p">,</span> <span class="s">&#39;ERRR&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span>
            <span class="nx">callback</span> <span class="nx">res</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="kc">null</span>


  <span class="p">,</span> <span class="nf">( err, res ) =&gt;</span>

    <span class="k">if</span> <span class="nx">err</span><span class="o">?</span>
      <span class="nx">log</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;An error while initialized modifier.&quot;</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>

    <span class="k">else</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>Server side</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><strong>Publish</strong>
current version of widget/theme/modifier.
First get type, then call publishing function.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.Publish = </span><span class="nf">( options ) -&gt;</span>

  <span class="nv">maxmertkit = </span><span class="nx">@maxmertkit</span><span class="p">()</span>

  <span class="k">switch</span> <span class="nx">maxmertkit</span><span class="p">.</span><span class="nx">type</span>

    <span class="k">when</span> <span class="s">&#39;widget&#39;</span>
      <span class="nx">@PublishWidget</span> <span class="nx">options</span>

    <span class="k">when</span> <span class="s">&#39;theme&#39;</span>
      <span class="nx">@PublishTheme</span> <span class="nx">options</span>

    <span class="k">when</span> <span class="s">&#39;modifier&#39;</span>
      <span class="nx">@PublishModifier</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><strong>Publish</strong>
current version of widget.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.PublishModifier = </span><span class="nf">( options ) -&gt;</span>

  <span class="nv">maxmertkit = </span><span class="nx">@maxmertkit</span><span class="p">()</span>

  <span class="nv">fileName = </span><span class="s">&#39;modifier.json&#39;</span>

  <span class="nx">async</span><span class="p">.</span><span class="nx">series</span>

    <span class="nv">modifier: </span><span class="nf">( callback ) =&gt;</span>
      
      <span class="nv">rawjson = </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="nx">fileName</span> <span class="p">)</span>
  
      <span class="k">if</span> <span class="o">not</span> <span class="nx">rawjson</span><span class="o">?</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s">&quot;couldn\&#39;t read </span><span class="si">#{</span><span class="nx">fileName</span><span class="si">}</span><span class="s"> file.&quot;</span><span class="p">)</span>
        <span class="nx">callback</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">null</span>

      <span class="k">else</span>
        <span class="nv">json = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">rawjson</span>
        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">json</span>


    <span class="nv">password: </span><span class="nf">( callback ) =&gt;</span>
      
      <span class="nx">dialog</span><span class="p">.</span><span class="nx">password</span> <span class="s">&#39;\nEnter your password: &#39;</span><span class="p">,</span> <span class="nf">( password ) -&gt;</span>
        <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">password</span>

  <span class="p">,</span> <span class="nf">( err, res ) =&gt;</span>

    <span class="k">if</span> <span class="nx">err</span><span class="o">?</span>
      <span class="nx">log</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;Publishing canceled.&quot;</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>

    <span class="k">else</span>
      
      <span class="nx">request</span>
        <span class="p">.</span><span class="nx">post</span><span class="p">(</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">pack</span><span class="p">.</span><span class="nx">homepage</span><span class="si">}</span><span class="s">/modifiers/</span><span class="si">#{</span><span class="nx">maxmertkit</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s">/</span><span class="si">#{</span><span class="nx">maxmertkit</span><span class="p">.</span><span class="nx">version</span><span class="si">}</span><span class="s">&quot;</span> <span class="p">)</span>
        <span class="p">.</span><span class="nx">set</span><span class="p">(</span> <span class="s">&#39;X-Requested-With&#39;</span><span class="p">,</span> <span class="s">&#39;XMLHttpRequest&#39;</span> <span class="p">)</span>
        <span class="p">.</span><span class="nx">send</span>
          <span class="nv">modifier: </span><span class="nx">res</span><span class="p">.</span><span class="nx">modifier</span>
          <span class="nv">password: </span><span class="nx">res</span><span class="p">.</span><span class="nx">password</span>
          <span class="nv">name: </span><span class="nx">maxmertkit</span><span class="p">.</span><span class="nx">name</span>
          <span class="nv">version: </span><span class="nx">maxmertkit</span><span class="p">.</span><span class="nx">version</span>
          <span class="nv">username: </span><span class="nx">maxmertkit</span><span class="p">.</span><span class="nx">author</span>
        
        <span class="p">.</span><span class="nx">end</span> <span class="nf">( res ) -&gt;</span>
          
          <span class="k">if</span> <span class="nx">res</span><span class="p">.</span><span class="nx">ok</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">requestSuccess</span> <span class="s">&quot;modifier </span><span class="si">#{</span><span class="nx">maxmertkit</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s">@</span><span class="si">#{</span><span class="nx">maxmertkit</span><span class="p">.</span><span class="nx">version</span><span class="si">}</span><span class="s"> successfully published.&quot;</span>
            <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>

          <span class="k">else</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">requestError</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">msg</span><span class="p">,</span> <span class="s">&#39;ERRR&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span>
            <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>#</h2>

<p>Initializing new widget or theme in current directory</p>

<h2>#</h2>

<p>exports.init = ( options ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <pre><code>types = ['widget', 'theme']
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <pre><code>async.series
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <pre><code>    type: ( callback ) -&gt;
        dialog.choose types, (i) -&gt;
            callback null, types[i]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <pre><code>    name: ( callback ) -&gt;
        defaultPkgName = 'test'
        dialog.prompt "name: (test) ", ( pkgName ) -&gt;
            if pkgName is '' then pkgName = defaultPkgName
            callback null, pkgName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <pre><code>    version: ( callback ) -&gt;
        defaultVersion = '0.0.0'
        dialog.prompt "version: (0.0.0) ", ( version ) -&gt;
            if version is '' then version = defaultVersion
            callback null, version
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <pre><code>    description: ( callback ) -&gt;
        dialog.prompt "description: ", ( description ) -&gt;
            callback null, description
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <pre><code>    repository: ( callback ) -&gt;
        dialog.prompt "repository: ", ( repository ) -&gt;
            callback null, repository
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <pre><code>    author: ( callback ) -&gt;
        dialog.prompt "author: ", ( author ) -&gt;
            callback null, author
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <pre><code>    license: ( callback ) -&gt;
        defaultLicense = 'BSD'
        dialog.prompt "license: (BSD) ", ( license ) -&gt;
            if license is '' then license = defaultLicense
            callback null, license
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <pre><code>, ( err, maxmertkitjson ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <pre><code>    @.writeConfirm maxmertkitjson, options
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h2>#</h2>

<p>Confirm writing json to the maxmertkit.json file</p>

<h2>#</h2>

<p>exports.writeConfirm = ( json, options ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <pre><code>dialog.confirm "Is everything correct? \n\n #{JSON.stringify(json, null, 4)}\n-&gt; ", ( ok ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <pre><code>        console.log ""
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <pre><code>        if not ok
            log.error("Initializing canceled")
            process.stdin.destroy()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <pre><code>        else
            fs.exists pack.maxmertkit, ( exists ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <pre><code>                if not exists
                    @.write json, options
                    process.stdin.destroy()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <pre><code>                else #if exists
                    log.error("File #{pack.maxmertkit} already exists.")
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <pre><code>                    dialog.confirm "Do you want to overwrite it and all other files in that folder? -&gt; ", ( ok ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <pre><code>                        if not ok
                            log.error("initialization canceled.")
                            process.stdin.destroy()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <pre><code>                        else
                            @.write json, options
                            process.stdin.destroy()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <h2>#</h2>

<p>Writing json to the maxmertkit.json file
Init other files</p>

<h2>#</h2>

<p>exports.write = ( json, options ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <pre><code>fs.writeFile pack.maxmertkit, JSON.stringify(json, null, 4), ( err ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <pre><code>    if err then log.error "initializing ‚Äì #{err}."
    log.success "file #{pack.maxmertkit} successfully created."
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <pre><code>if json.type is 'widget'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <pre><code>    # Initialize _index.sass
    fs.writeFile '_index.sass', mustache.render( templates.widget, json ) , ( err ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <pre><code>        if err?
            log.error "Coluldn\'t initialize _index.sass file."
            process.stdin.destroy()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <pre><code>        else
            log.success "file _index.sass successfully created."
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <pre><code>else
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <pre><code>    # If theme
    fs.writeFile 'theme.json', mustache.render( templates.theme, json ) , ( err ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <pre><code>        if err?
            log.error "Coluldn\'t initialize theme.json file."
            process.stdin.destroy()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <pre><code>        else
            log.success "file theme.json successfully created."
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>rmdirSyncForce = ( path ) ->
    if path[path.length - 1] isnt '/'
        path = path + '/'</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <pre><code>files = fs.readdirSync path
filesLength = files.length
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <pre><code>if filesLength
    for file in files
        fileStats = fs.statSync path+file
        if fileStats.isFile()
            fs.unlinkSync(path + file)
        if fileStats.isDirectory()
            rmdirSyncForce(path + file)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <pre><code>fs.rmdirSync path
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <h2>#</h2>

<p>Packing widget or theme in current folder. The folders name should be the same as your package name in maxmertkit.json</p>

<h2>#</h2>

<p>exports.pack = ( options, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <pre><code>maxmertkitjson = @.maxmertkit()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <pre><code># Check if package name is the same as folder name
if path.basename( path.resolve('.') ) is "#{maxmertkitjson.name}"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <pre><code>    directoryName = "/tmp/#{maxmertkitjson.name}"
    fileName = "#{maxmertkitjson.name}@#{maxmertkitjson.version}.tar"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <pre><code>    # Need to do a lot of things one after another
    async.series
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <pre><code>        # Remove directory in /tmp folder is it exists
        rmdir: ( callback ) =&gt;
            fs.exists directoryName, ( exists ) -&gt;
                if exists
                    rmdirSyncForce directoryName, callback
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>          </pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <pre><code>                callback null, 'yes'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <pre><code>        # Create directory in /tmp folder
        dir: ( callback ) =&gt;
            fs.mkdir directoryName, 0o0777, () -&gt;
                callback( null, directoryName )
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <pre><code>        # Copy current widget or theme to /tmp without dependencies
        store: ( callback ) =&gt;              
            @.store callback
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <pre><code>        # Do code precompilation
        precompile: ( callback ) =&gt;
            @.precompile directoryName, callback
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <pre><code>        # Pack current widget
        pack: ( callback ) =&gt;
            fstream.Reader
                path: directoryName
                type: 'Directory'
            .pipe( tar.Pack({}) )
            .pipe fstream.Writer( "/tmp/#{fileName}" ).on 'close', ( err ) -&gt;
                if err?
                    log.error 'Failed to create package.'
                    if not callback? then process.stdin.destroy() else callback err, fileName
                else
                    callback(null, fileName)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <pre><code>        # Restore .tar file to the current directory
        restore: ( callback ) =&gt;
            @.restore( fileName, callback )
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <pre><code>    , ( err, res ) -&gt;
        log.success "Finished to create package"
        if not callback? then process.stdin.destroy() else callback null, fileName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <pre><code>else
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <pre><code>    log.error "The folders name (#{path.basename( path.resolve('.') )}) should be the same as your package name in maxmertkit.json (#{maxmertkitjson.name})."
    if not callback? then process.stdin.destroy() else callback no, fileName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <h2>#</h2>

<p>Store current folder in /tmp/ folder.</p>

<h2>#</h2>

<p>exports.store = ( callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <pre><code>maxmertkitjson = @.maxmertkit()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <pre><code>directoryName = "/tmp/#{maxmertkitjson.name}"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <pre><code>ncp '.', directoryName,
    filter: (name) -&gt;
        currentName =  path.relative('.',name).split( path.sep )[0]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      </pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <pre><code>        if currentName.charAt(0) is '.' or path.relative('.',name).indexOf('dependences') isnt -1 or path.relative('.',name).indexOf('.tar') isnt -1
            no
        else
            yes
, ( err ) -&gt;
    if err
        log.error "Failed to store current directory to #{directoryName} folder. Do you have permissions?"
        if not callback? then process.stdin.destroy() else callback err, directoryName
    else
        if not callback? then process.stdin.destroy() else callback null, directoryName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <h2>#</h2>

<p>Restore package from /tmp folder to the current folder</p>

<h2>#</h2>

<p>exports.restore = ( fileName, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <pre><code>fs.readFile path.join( '/tmp/', fileName ), ( err, data ) -&gt;
    if err?
        log.error "Failed to restore #{fileName} from /tmp folder. Maybe there is no such file or folder."
        if not callback? then process.stdin.destroy() else callback err, fileName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <pre><code>    else
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <pre><code>        fs.writeFile path.join( '.', fileName ), data, ( err ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <pre><code>            if err?
                log.error "Failed to restore #{fileName} from /tmp folder. Maybe you do not have permissions to write in current folder."
                if not callback? then process.stdin.destroy() else callback err, fileName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <pre><code>            else
                if not callback? then process.stdin.destroy() else callback null, fileName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <h2>#</h2>

<p>Unpacking widget or theme in current folder.</p>

<h2>#</h2>

<p>exports.unpack = ( fileName, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <pre><code>maxmertkitjson = @.maxmertkit()
fileName = "#{maxmertkitjson.name}@#{maxmertkitjson.version}.tar"
fs
    .createReadStream( path.join '.', fileName )
    .pipe tar.Extract
        path: '.'
    .on 'error', ( err ) -&gt;
        log.error "Failed to unpack #{fileName} width error:\n#{err}"
        if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback err, fileName
    .on 'end', () -&gt;
        log.success "File #{fileName} unpacked."
        if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback null, fileName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <h2>#</h2>

<p>Prepare main file of widget for publishing</p>

<h2>#</h2>

<p>exports.precompile = ( directoryName, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <pre><code>maxmertkitjson = @.maxmertkit()
fileName = path.join( directoryName, '_index.sass' )
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <pre><code>async.series
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <pre><code>    widget: ( callback ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <pre><code>        fs.readFile fileName, ( err, data ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <pre><code>            if err? then callback( err, null )
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <pre><code>            callback null, data
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <pre><code>, ( err, data ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <pre><code>    if err?
        log.error "Failed to precompile #{fileName}."
        if not callback? then process.stdin.destroy() else callback err, fileName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <pre><code>    else
        maxmertkitjson.data = data.widget
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <pre><code>        result = mustache.render templates.widgetFinal, maxmertkitjson
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <pre><code>        fs.writeFile fileName, result, ( err ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <pre><code>                if err?
                    log.error "Failed to precompile #{fileName}."
                    if not callback? then process.stdin.destroy() else callback err, fileName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <pre><code>                else
                    if not callback? then process.stdin.destroy() else callback null, fileName
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <h2>#</h2>

<p>Install all dependences</p>

<h2>#</h2>

<p>exports.install = -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <pre><code>maxmertkitjson = @.maxmertkit()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <pre><code>if not maxmertkitjson.dependences? or maxmertkitjson.dependences.length &lt;= 0
    log.error "Couldn\'t install your dependences because you don\'t have any."
    process.stdin.destroy()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <pre><code>else
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <pre><code>    deps = maxmertkitjson.dependences
    dependences = []
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <pre><code>    for name, version of deps
        dependences.push name: name, version: version
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <pre><code>    async.series
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <pre><code>        exists: ( callback ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <pre><code>            async.every dependences, @onServerIsExistsVersion, (err, results) =&gt;
                if err
                    callback err, null
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <pre><code>                else
                    callback null, yes
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <pre><code>        get: ( callback ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <pre><code>            async.every dependences, @onServerGetDependencyWidget, ( err, results ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <pre><code>                if err
                    callback err, null
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <pre><code>                else
                    callback null, yes
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <pre><code>    , ( err, data ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <pre><code>        if err?
            console.log '\n'
            log.error "Installation aborted because some widgets or their versions don\'t exists on server."
            process.stdin.destroy()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <h1>==============================</h1>

<h1>============================== SERVER FEATURES</h1>

<h1>==============================</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <h2>#</h2>

<p>Get dependency from server</p>

<h2>#</h2>

<p>exports.onServerGetDependencyWidget = ( widget, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <pre><code>writer = fs.createWriteStream("/tmp/#{widget.name}@#{widget.version}.tar")
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <pre><code>req = request
    .get( "#{pack.homepage}/api/0.1/widgets/#{widget.name}/#{widget.version}/tar" )
    .set( 'X-Requested-With', 'XMLHttpRequest' )
    .set('Accept', 'application/tar')
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <pre><code>req.pipe writer
    # .end ( res ) -&gt;
    #   if res.ok
    #       console.log res
    #       # log.requestSuccess res.body.msg, 'OK', res.status
    #       if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback null, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      </pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <pre><code>    #   else
    #       log.requestError res.body.msg, 'ERRR', res.status
    #       if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback yes, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <h2>#</h2>

<p>Check if widget or theme is exists</p>

<h2>#</h2>

<p>exports.onServerIsExistsApp = ( options, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <pre><code>widget = @.maxmertkit()
if options.version? and options.version is yes
    @onServerIsExistsVersion widget, callback
else
    @onServerIsExists widget, callback
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>exports.onServerIsExists = ( widget, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <pre><code>request
    .get( "#{pack.homepage}/api/0.1/widgets/#{widget.name}" )
    .set( 'X-Requested-With', 'XMLHttpRequest' )
    .end ( res ) -&gt;
        if res.ok
            log.requestSuccess res.body.msg, 'OK', res.status
            if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback null, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      </pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <pre><code>        else
            log.requestError res.body.msg, 'ERRR', res.status
            if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback yes, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <h2>#</h2>

<p>Check if widget or theme with current version is exists</p>

<h2>#</h2>

<p>exports.onServerIsExistsVersionApp = ( options, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <pre><code>widget = @.maxmertkit()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <pre><code>@onServerIsExistsVersion widget, callback
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>exports.onServerIsExistsVersion = ( widget, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <pre><code>async.series
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <pre><code>    exists: ( callback ) =&gt;
        exports.onServerIsExists( widget, callback )
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <pre><code>, ( err, res ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <pre><code>    if err
        if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback err, widget.name
    else
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      </pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <pre><code>        request
            .get( "#{pack.homepage}/api/0.1/widgets/#{widget.name}/#{widget.version}" )
            .set( 'X-Requested-With', 'XMLHttpRequest' )
            .end ( res ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>          </pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <pre><code>                if res.ok
                    log.requestSuccess res.body.msg, 'OK', res.status
                    if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback null, widget.name
                else
                    log.requestError res.body.msg, 'ERRR', res.status
                    if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback yes, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <h2>#</h2>

<p>Publish current version of widget or theme</p>

<h2>#</h2>

<p>exports.onServerPublish = ( options, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <pre><code>widget = @.maxmertkit()
widget.dependencies = [] if not widget.dependencies?
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <pre><code>fileName = "#{widget.name}@#{widget.version}.tar"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <pre><code>async.series
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <pre><code>    # exists: ( callback ) =&gt;
    #   @.onServerIsExistsVersion( options, callback )
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <pre><code>    pack: ( callback ) =&gt;
        @.pack( options, callback )
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <pre><code>    password: ( callback ) =&gt;
        dialog.password '\nEnter your password: ', ( password ) -&gt;
            callback null, password
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <pre><code>, ( err, res ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <pre><code>    if err
        log.error "Could not publish widget."
        if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback err, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <pre><code>    else
        request
            .post( "#{pack.homepage}/api/0.1/widgets/#{widget.name}/#{widget.version}/publish" )
            .set( 'X-Requested-With', 'XMLHttpRequest' )
            .attach( 'pack', fileName )
            .field( 'packName', res.pack)
            .field( 'name', widget.name)
            .field( 'version', widget.version)
            .field( 'password', res.password)
            .field( 'username', widget.author )
            # .field( 'dependencies', widget.dependencies )
            .end ( res ) -&gt;
                if res.ok
                    log.requestSuccess "widget #{widget.name}@#{widget.version} successfully published."
                    fs.unlink "#{widget.name}@#{widget.version}.tar", (err) -&gt;
                        if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback null, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <pre><code>                else
                    log.requestError res.body.msg, 'ERRR', res.status
                    fs.unlink "#{widget.name}@#{widget.version}.tar", (err) -&gt;              
                        if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback yes, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <h2>#</h2>

<p>Unpublish current version of widget or theme</p>

<h2>#</h2>

<p>exports.onServerUnpublish = ( options, callback ) -></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <pre><code>widget = @.maxmertkit()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <pre><code>fileName = "#{widget.name}@#{widget.version}.tar"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <pre><code>async.series
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <pre><code>    password: ( callback ) =&gt;
        dialog.password '\nEnter your password: ', ( password ) -&gt;
            callback null, password
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <pre><code>, ( err, res ) =&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <pre><code>    if err
        log.error "Could not unpublish widget."
        if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback err, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <pre><code>    else
        request
            .del( "#{pack.homepage}/api/0.1/widgets/#{widget.name}/#{widget.version}" )
            .set( 'X-Requested-With', 'XMLHttpRequest' )
            .field( 'packName', fileName)
            .field( 'name', widget.name)
            .field( 'version', widget.version)
            .field( 'password', res.password)
            .field( 'username', widget.author )
            .end ( res ) -&gt;
                if res.ok
                    log.requestSuccess "widget #{widget.name}@#{widget.version} successfully unpublished."
                    if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback null, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <pre><code>                else
                    log.requestError res.body.msg, 'ERRR', res.status                       
                    if not callback? or typeof callback is 'object' then process.stdin.destroy() else callback yes, widget.name
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <h1>exports.pack = -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <h1>packFile = "/tmp/#{pack.name}@#{pack.version}.tar"</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <h1>fstream.Reader</h1>

<h1>type: "Directory"</h1>

<h1>path: '.'</h1>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <h1>.pipe(tar.Pack({}))</h1>

<h1>.on 'error', =></h1>

<h1>log.error 'Failed to create package.'</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <h1>.pipe fstream.Writer( packFile )</h1>

<h1>.on "close", =></h1>

<h1>log.success "Finished to create package"</h1>

<h1>@.sendPack packFile</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <h1>#</h1>

<h1>Check if widget is exists at the server</h1>

<h1>#</h1>

<h1>exports.isExist = ( widget, callback ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <h1>request</h1>

<h1>.get( "#{pack.homepage}/api/0.1/widgets/#{widget.name}" )</h1>

<h1>.set('Accept', 'application/json')</h1>

<h1>.end (res) -></h1>             </td>             <td class="code">               <div class="highlight"><pre>      </pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <h1>if res.statusCode is 502 or res.statusCode is 404 or not res.body.done</h1>

<h1>log.requestError("#{pack.homepage}/api/0.1/widgets/#{widget.name}", widget.name) if widget.options.silent isnt on</h1>

<h1>callback( false )</h1>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <h1>else</h1>

<h1>log.requestSuccess("#{pack.homepage}/api/0.1/widgets/#{widget.name}", widget.name) if widget.options.silent isnt on</h1>

<h1>callback( true )</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <h1>#</h1>

<h1>Init new widget/theme</h1>

<h1>#</h1>

<h1>exports.init = ( options ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <h1># Writes <pack.maxmertkit> json file</h1>

<h1>writeJSON = ( json ) -></h1>

<h1>fs.writeFile pack.maxmertkit, JSON.stringify(json, null, 4), ( err ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre>                          </pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <h1>if err then log.error("while initializing ‚Äì #{err}")</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <h1>log.success("file #{pack.maxmertkit} successfully created.")</h1>

<h1>process.stdin.destroy()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <h1>type = ['widget', 'theme']</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <h1>console.log 'Choose what you will create'</h1>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <h1>dialog.choose type, (i) -></h1>

<h1># console.log 'You chose %s', type[i]</h1>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <h1>dialog.prompt "#{type[i]} name: (test) ", ( pkgName ) -></h1>

<h1>pkgName = 'test' if pkgName is ''</h1>

<h1># console.log 'Hello %s', pkgName</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <h1>dialog.prompt "version: (0.0.0) ", ( version ) -></h1>

<h1>version = '0.0.0' if version is ''</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <h1>dialog.prompt "description: ", ( description ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <h1>dialog.prompt "repository: ", ( repository ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <h1>dialog.prompt "author: ", ( author ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <h1>dialog.prompt "license: (BSD) ", ( license ) -></h1>

<h1>license = 'BSD' if license is ''</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <h1>maxmertkitjson =</h1>

<h1>type: type[i]</h1>

<h1>name: pkgName</h1>

<h1>version: version</h1>

<h1>description: description</h1>

<h1>repository: repository</h1>

<h1>author: author</h1>

<h1>license: license</h1>

<h1>console.log ""</h1>             </td>             <td class="code">               <div class="highlight"><pre>              </pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <h1>dialog.confirm "Is everything correct? \n\n #{JSON.stringify(maxmertkitjson, null, 4)}\n-> ", ( ok ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre>                  </pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <h1>console.log ""</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <h1>if not ok</h1>

<h1>log.error("Initializing canceled")</h1>

<h1>process.stdin.destroy()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <h1>else</h1>

<h1>fs.exists pack.maxmertkit, ( exists ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre>                      </pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <h1>if not exists</h1>

<h1>writeJSON maxmertkitjson</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <h1>else #if exists</h1>

<h1>log.error("File #{pack.maxmertkit} already exists.")</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <h1>dialog.confirm "Do you want to overwrite it? -> ", ( ok ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <h1>if not ok</h1>

<h1>log.error("initialization canceled.")</h1>

<h1>process.stdin.destroy()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <h1>else</h1>

<h1>writeJSON maxmertkitjson</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <h1>exports.install = ( widget, callback ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <h1>fileName = "#{widget.name}@#{widget.version}.tar"</h1>

<h1>stream = fs.createWriteStream( fileName )</h1>

<h1>req = request.get( "#{pack.homepage}/api/0.1/widgets/#{widget.name}/#{widget.version}/tar" )</h1>

<h1>req.pipe(stream)</h1>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <h1>stream.on 'close', -></h1>

<h1>fs</h1>

<h1>.createReadStream( fileName )</h1>

<h1>.pipe( tar.Extract( path: './' ) )</h1>

<h1>.on 'error', ( err )-></h1>

<h1>log.error err</h1>

<h1>.on 'end', -></h1>

<h1>fs.unlink fileName</h1>

<h1>log.success "Installation of #{fileName} complete."</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <h1>callback()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <h1>exports.sendPack = (file) -></h1>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <h1>fs.readFile pack.maxmertkit, ( err, data ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <h1>if err</h1>

<h1>log.error("can\'t find #{pack.maxmertkit} file.")</h1>

<h1>process.stdin.destroy()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <h1>if data?</h1>

<h1>maxmertkitjson = JSON.parse data</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <h1>request</h1>

<h1>.post( "#{pack.homepage}/api/0.1/#{maxmertkitjson.author}/publish" )</h1>

<h1>.attach( path.basename( file ), file )</h1>

<h1>.end ( res ) -></h1>

<h1>console.log res</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <h1>exports.checkPack = -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <h1>fs.readFile pack.maxmertkit, ( err, data ) =></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <h1>if err</h1>

<h1>log.error("can\'t find #{pack.maxmertkit} file.")</h1>

<h1>process.stdin.destroy()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <h1>if data?</h1>

<h1>maxmertkitjson = JSON.parse data</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <h1>request</h1>

<h1>.get( "#{pack.homepage}/api/0.1/widgets/#{maxmertkitjson.name}/#{maxmertkitjson.version}" )</h1>

<h1>.set('Accept', 'application/json')</h1>

<h1>.end (res) =></h1>

<h1>if not res.ok</h1>

<h1>log.requestError("Getting information about #{pack.name} if failed.")</h1>

<h1>process.stdin.destroy()</h1>

<h1>else</h1>

<h1>@.pack()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <h1>exports.publish = ( author ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <h1>dialog.password 'Password: ', ( pass ) =></h1>

<h1>request</h1>

<h1>.post( "#{pack.homepage}/api/0.1/loginAJAX" )</h1>

<h1>.send</h1>

<h1>username: author</h1>

<h1>password: pass</h1>

<h1>.set('Accept', 'application/json')</h1>

<h1>.end (res) =></h1>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <h1>if not res.ok</h1>

<h1>log.error("Authorization Failed. Check the author name in maxmert.json or your password. Or maybe you need to register at #{pack.homepage}/api/0.1/?")</h1>

<h1>process.stdin.destroy()</h1>

<h1>else</h1>

<h1>log.success("Authorization succeed.")</h1>

<h1>@.checkPack()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <pre><code>                # @.pack -&gt;
                #   @.sendPack()
                # process.stdin.destroy()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <h1>exports.installJSON = () -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <h1>fs.readFile pack.maxmertkit, ( err, data ) -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <h1>if err</h1>

<h1>log.error("can\'t find #{pack.maxmertkit} file.")</h1>

<h1>process.stdin.destroy()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <h1>if data?</h1>

<h1>maxmertkitjson = JSON.parse data</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <h1>if not maxmertkitjson.dependences?</h1>

<h1>console.log "There is no dependences in #{pack.maxmertkit} file."</h1>

<h1>process.stdin.destroy()</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <h1>else</h1>

<h1>for widget, version of maxmertkitjson.dependences</h1>

<h1>exports.install</h1>

<h1>name: widget</h1>

<h1>version: version</h1>

<h1>, -></h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <pre><code>            # console.log exports.install
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <pre><code># fs.exists pack.maxmertkit, ( exists ) -&gt;
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <pre><code>#   if exists
#       fs.readFile
#       console.log maxmertkitjson
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 